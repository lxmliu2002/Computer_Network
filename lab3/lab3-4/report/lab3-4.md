# <center>**计算机网络实验报告**</center>

## <center>**Lab3-4 基于 UDP 服务设计可靠传输协议**</center>

## <center> **网络空间安全学院 信息安全专业**</center>

## <center> **2112492 刘修铭 1063**</center>

# 一、实验要求

实验要求主要包括三个方面：

1. **停等机制与滑动窗口机制性能对比**：通过改变延时和丢包率，完成停等机制和滑动窗口机制性能的对比实验。

2. **滑动窗口机制中不同窗口大小对性能的影响**：分别测试滑动窗口机制中不同窗口大小对性能的影响，包括累计确认和选择确认两种情形。

3. **滑动窗口机制中相同窗口大小情况下，累计确认和选择确认的性能比较**：在相同窗口大小的情况下，比较累计确认和选择确认的性能表现。



# 二、实验内容

本次实验基于前面三次实验而实现，协议设计等不再赘述。

本次实验中将前面三次实验的代码稍作修改，将每次传输的**吞吐率**及**时延**等信息输出到文件中，便于后续可视化分析。 

本次实验主要使用**控制变量法**完成性能对比测试：

* 停等机制与滑动窗口机制性能对比：丢包率及时延相同的情况下，测试两种传输机制（需分别使用两种确认机制进行测试）的吞吐率及时延； 
* 滑动窗口机制中不同窗口大小对性能的影响（累计确认和选择确认两种情形）：丢包率及时延相同的情况下，通过改变窗口大小，分别测试两种确认机制的吞吐率及时延； 
* 滑动窗口机制中相同窗口大小情况下，累计确认和选择确认的性能比较：窗口大小相同的情况下，分别改变吞吐率或时延，测试并比较两种确认机制下传输文件的吞吐率及时延。 



# 三、实验结果及分析

实验过程主要通过控制变量法进行性能对比测试，分为以下几个步骤：

## （一）**停等机制与滑动窗口机制性能对比**

- 设置丢包率为 0，改变时延，比较停等机制和滑动窗口机制（累计确认）的吞吐率和时延。

   - **实验结果：**
      | 时延(ms) | 停等机制吞吐率 | 滑动窗口吞吐率（累计确认） | 停等机制时延 | 滑动窗口时延（累计确认） |
      |:--------:|:-------------:|:----------------------:|:------------:|:------------------------:|
      | 10       |            |                     |           |                       |
      | 20       |            |                     |           |                       |
      | 30       |            |                     |           |                       |

   - **可视化分析：**
     
      
     
   - **分析：** 

   - 本程序设定的超时重传时间阈值为 20 ms，若时延在阈值之前时，滑动窗口的传输时间低于停等协议，吞吐率高于停等协议；当时延超过阈值时，滑动窗口的传输时间高于停等协议，吞吐率低于停等协议。

   - 当时延较小小于阈值时，因为滑动窗口机制允许连续发送几个报文，而不是等到回复报文回复之后才继续发送 下一个报文，因此相当停等机制效率更高。当时延超过阈值时会发生超时重传现象，停等机制会重发该报文，但滑动窗口机制会重发窗口内所有未确认的报文段，相对于停等机制效率会低。

   * *从图像中而已看出，当延迟时间较小的时候，GBN的性能要优于停等机制，并且在延迟时间*

     *小于50ms的时候，GBN和停等机制的实验变化大约都是线性的。这是因为在本次实验中，并没*

     *有设置丢包，因此所有的数据包都会正常到达，并且RTO设置为50ms，因此时延的差异主要就*

     *是由传输的延迟时间导致的，而这个变化是线性的，因此时延变化也大约为线性。并且由于很小*

     *概率触发超时重传，因此GBN也几乎不存在超时重传的额外开销。*

     *而当延迟时间超过了50ms之后，两边都会产生超时重传，但是对于超时重传，停等机制的*

     *影响不大，GBN则会产生不必要的超时重传，并且会重传窗口中的全部数据包，这会导致较大的*

     *额外开销影响性能，因此可以看出当延迟时间超过50ms之后，GBN的性能迅速下降，甚至不如*

     *停等机制。*

     *因此可以得出结论，当延迟时间较小的时候，由于流水线机制GBN性能明显优于停等机制。*

     *但当延迟时间超过了设定的RTO的时候，GBN就会产生大量的不必要重传，严重影响性能。*

   * *丢包率为0，改变时延，滑动窗口存在加速效果，但不明显。*

     *– 分析打印的日志可知，这主要是因为，当发送一段时间后且没有丢包，滑动窗口会达*

     *到动态平衡，每当窗口收到一个确认报文，就会有一个空闲位置，也会立即发送新报*

     *文段，所以性能提升不明显。*

   

   - 在低丢包率和不同时延下，滑动窗口机制相对于停等机制表现更优，具有更高的吞吐率和更低的时延。这可能是因为滑动窗口机制能够充分利用网络带宽，减少传输的等待时间。

- 设置丢包率为 0，改变时延，比较停等机制和滑动窗口机制（选择确认）的吞吐率和时延。

   - **实验结果：**
      | 时延(ms) | 停等机制吞吐率 | 滑动窗口吞吐率（选择确认） | 停等机制时延 | 滑动窗口时延（选择确认） |
      |:--------:|:-------------:|:------------------------:|:------------:|:-------------------------:|
      | 10       |            |                       |           |                        |
      | 20       |            |                       |           |                        |
      | 30       |            |                       |           |                        |

   - **可视化分析：**
     
     
     ​       
     
   - **分析：** 

      - 

- 设置时延为 0，改变丢包率，比较停等机制和滑动窗口机制（累计确认）的吞吐率和时延。

   - **实验结果：**
      | 丢包率(%) | 停等机制吞吐率 | 滑动窗口吞吐率（累计确认） | 停等机制时延 | 滑动窗口时延（累计确认） |
      |:---------:|:-------------:|:----------------------:|:------------:|:------------------------:|
      | 1         |            |                     |           |                       |
      | 5         |            |                     |           |                       |
      | 10        |            |                     |           |                       |

   - **可视化分析：**
     
     
     ​       
     
   - **分析：** 

   - *当丢包率较小的时候，GBN的性能要优于滑动窗口，并且通过吞吐率的*

      *比值可以看到，在丢包率为0的时候，GBN的吞吐率大约是停等机制的2倍。在实验测量的时候，*
      
      *选取的滑动窗口大小为5，由于流水线机制，如果不考虑上层应用的其余开销的话，理论上GBN*
      
      *的吞吐量能够达到停等机制的5倍，但是在实验中，由于存在端端延迟以及文件读写和处理等操*
      
      *作，所以加速比并没有达到理论值。*
      
   - *随着丢包率的增加，GBN的性能逐渐下降，并且在较大的丢包率的情况下，GBN的性能甚至*

      *不如停等机制。这个原因也很容易分析，由于丢包率较大，因此在GBN中会出现大量的重复*
      
      *ACK，导致超时重传。重传的时候会将窗口中的所有数据包全部重新发送，一方面会占用带宽资*
      
      *源，另一方面很有可能再次出现丢包。此外，由于GBN必须要顺序确认数据包，因此当窗口中的*
      
      *一组数据包中第一个数据包发生丢失的时候，后续到达的其他数据包也将被丢弃，使得原本只需*
      
      *要重传第一个数据包变成了所有数据包都为被确认，因此在一定程度上也严重影响了性能。*
      
      *因此我们可以得出结论，当丢包率较小的时候，由于流水线和滑动窗口的存在，GBN的性能*
      
      *优于停等机制。而当丢包率较高的时候，GBN由于存在较大的重传开销，导致性能下降，此时*
      
      *GBN的性能不如停等机制。*
      
   - *时延为0，改变丢包率，滑动窗口的加速效果非常明显。这是因为：*

      *– 采用流水线发送机制。*
      
      *– 有丢包时，滑动窗口机制存在三次快速重传，可以避免超时等待的时间，当收到三次*
      
      *冗余的ACK 即可重新发包。*
      
   - 

      - 当丢包率较低时，滑动窗口机制要比停等机制性能好，表现为吞吐率高，时延低；为当丢包率较高时，滑动窗口机制的性能反而低于停等机制。
      - 分析原因可知，此处的滑动窗口使用累计确认机制，当发生丢包时将会发送窗口大小缓冲区中所有数据包，造成一定程度的资源浪费，使得性能下降。

- 设置时延为 0，改变丢包率，比较停等机制和滑动窗口机制（选择确认）的吞吐率和时延。

   - **实验结果：**
      | 丢包率(%) | 停等机制吞吐率 | 滑动窗口吞吐率（选择确认） | 停等机制时延 | 滑动窗口时延（选择确认） |
      |:---------:|:-------------:|:------------------------:|:------------:|:-------------------------:|
      | 1         |            |                       |           |                        |
      | 5         |            |                       |           |                        |
      | 10        |            |                       |           |                        |

   - **可视化分析：**
          

   - **分析：** 

      - 

- **综合分析：**

- *滑动窗口机制总体比停等机制有更高的性能：时延更短、吞吐率更大*

   *– 滑动窗口机制可以同时发送多条消息，而停等机制一次只能发送一个报文。因此，滑*

   *动窗口对信道的利用率更高，传输时延更低，吞吐率更大。*



## （二）**滑动窗口机制中不同窗口大小对性能的影响**

- 设置丢包率为 0，改变窗口大小，比较滑动窗口机制（累计确认）的吞吐率和时延。

   - **实验结果：**
      | 窗口大小 | 滑动窗口吞吐率（累计确认） | 滑动窗口时延（累计确认） |
      |:--------:|:----------------------:|:------------------------:|
      | 5        |                     |                       |
      | 10       |                     |                       |
      | 15       |                     |                       |

   - **可视化分析：**
     
     
     ​       
     
   - **分析：** 

   - *结果：由表可知，当窗口比较小时，性能比较好，而当窗口逐渐增大后，性能会下降，但增*

      *大到一定程度，继续增大窗口，性能又会有所提升。*
      
   - *丢包率为0 时，只改变延时，滑动窗口的加速比未达到窗口大小比。*

      *– 这是因为当滑动窗口达到平衡时，窗口内一收到一个确认报文，就会有一个空闲位置，*
      
      *也会立即发送新报文段，所以达到一个动态平衡的状态。（这主要是因为在本程序中，*
      
      *没有上层应用缓存报文的时延，导致一有空位就可以发送，而在实际中，存在上层应*
      
      *用产生和给派报文的过程，以及窗口内的缓存时间）。*
      
      *窗口大小为1 时的效果跟停等机制的效果相近*
      
      *• 窗口小于等于3 时，无法快速重传，导致效果与停等机制的效果相近。*
      
      *• 三次快速重传使得滑动窗口加速效果更明显，且在丢包率高时更明显*
      
   - 

      - 

- 设置丢包率为 0，改变窗口大小，比较滑动窗口机制（选择确认）的吞吐率和时延。

   - **实验结果：**
      | 窗口大小 | 滑动窗口吞吐率（选择确认） | 滑动窗口时延（选择确认） |
      |:--------:|:------------------------:|:------------------------:|
      | 5        |                       |                       |
      | 10       |                       |                       |
      | 15       |                       |                       |

   - **可视化分析：**
     
     
     ​       
     
   - **分析：** 

      - 

- 设置时延为 0，改变丢包率，比较滑动窗口机制（累计确认）的吞吐率和时延。

   - **实验结果：**
      | 丢包率(%) | 滑动窗口吞吐率（累计确认） | 滑动窗口时延（累计确认） |
      |:---------:|:----------------------:|:------------------------:|
      | 1         |                     |                       |
      | 5         |                     |                       |
      | 10        |                     |                       |

    - **可视化分析：**
      
      
      ​     
      
   - **分析：** 

   - *从图像中可以看出，窗口大小对于吞吐量的影响情况会受到丢包率的影响。当丢包率较小的*

      *时候，吞吐量随着窗口大小的增加而提升，这是很好理解的。由于丢包率较小，因此影响GBN的*
      
      *非必要重传很少发生，因此GBN的性能由于流水线机制会随着窗口大小的增加而提升。*
      
      *而随着丢包率的上升，窗口大小带来的收益逐渐反转。可以看到当丢包率达到20%的时候，*
      
      *窗口越大，性能越差，这也很好理解。原因是丢包率较大，会产生大量超时重传，而窗口越大，*
      
      *超时重传的开销越大，因此性能越差。*
      
   - *结果：当丢包率较低时，不同窗口大小的传输时间差别不大；当丢包率较高时，随着窗口大*

      *小增大，传输时间增大，吞吐率减小。*
      
      *原因：因为如果一个包丢失，那么在发送缓冲区中后面发送的包都是无意义的，所以窗口越*
      
      *大，一旦数据报丢失， 要重发的数据报就越多，这就导致了窗口变大，性能反而下降。*
      
   - 

      - 

- 设置时延为 0，改变丢包率，比较滑动窗口机制（选择确认）的吞吐率和时延。

   - **实验结果：**
      | 丢包率(%) | 滑动窗口吞吐率（选择确认） | 滑动窗口时延（选择确认） |
      |:---------:|:------------------------:|:------------------------:|
      | 1         |                       |                       |
      | 5         |                       |                       |
      | 10        |                       |                       |

   - **可视化分析：**
     
     
     ​       
     
   - **分析：**

   - *从总体上看，在不同的丢包率和延时下，窗口越大，时延越低、吞吐率越大**因为窗口越大，可以同时发送的报文就越多，有利于更加充分的利用信道，降低时延，提*

      *高吞吐率。*
      
   - 

      - 

- **综合分析：**

## （三）**滑动窗口机制中相同窗口大小情况下，累计确认和选择确认机制的性能比较**

- 设置丢包率为 0，保持窗口大小相同，改变时延，比较滑动窗口机制的累计确认和选择确认的吞吐率和时延。

   - **实验结果：**
      | 时延(ms) | 滑动窗口吞吐率（累计确认） | 滑动窗口吞吐率（选择确认） | 滑动窗口时延（累计确认） | 滑动窗口时延（选择确认） |
      |:--------:|:----------------------:|:------------------------:|:------------------------:|:------------------------:|
      | 10       |                     |                       |                       |                       |
      | 20       |                     |                       |                       |                       |
      | 30       |                     |                       |                       |                       |

   - **可视化分析：**
     
     
     ​       
     
   - **分析：** 

      - 

- 设置时延为 0，保持窗口大小相同，改变丢包率，比较滑动窗口机制的累计确认和选择确认的吞吐率和时延。

   - **实验结果：**
      | 丢包率(%) | 滑动窗口吞吐率（累计确认） | 滑动窗口吞吐率（选择确认） | 滑动窗口时延（累计确认） | 滑动窗口时延（选择确认） |
      |:---------:|:----------------------:|:------------------------:|:------------------------:|:------------------------:|
      | 1         |                     |                       |                       |                       |
      | 5         |                     |                       |                       |                       |
      | 10        |                     |                       |                       |                       |

   - **可视化分析：**
     
     
     ​       
     
   - **分析：** 

      - 

- **综合分析：**



# 四、实验总结

综合以上实验结果和分析，可以得出以下结论：





# 五、问题思考

 





**实验报告完善提示：**

1. 在实验过程中涉及到的数据或图表应该具体展示出来，方便读者直观理解实验结果。
2. 结果分析部分要深入，解释实验结果的原因，比如为什么在某种情况下滑动窗口机制优于停等机制，窗口大小的变化如何影响性能等。
3. 讨论中可以涉及到实验的局限性，可能的改进方案，以及与现有文献的对比等。
4. 如果有需要，可以在报告中加入参考文献，以支持实验结论的可靠性。





# 六、说明

感谢各位老师、助教学长学姐的悉心指导！

本学期实验所涉及源代码、可执行文件及实验报告均已上传至[Github仓库](https://github.com/lxmliu2002/Computer_Networking)，且均已开源。
